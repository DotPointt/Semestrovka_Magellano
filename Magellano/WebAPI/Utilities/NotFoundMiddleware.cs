namespace WebAPI.Utilities
{
	public class NotFoundMiddleware
	{
		private readonly RequestDelegate _next;
		private readonly ILogger<NotFoundMiddleware> _logger;

		public NotFoundMiddleware(RequestDelegate next, ILogger<NotFoundMiddleware> logger)
		{
			_next = next;
			_logger = logger;
		}	

		public async Task Invoke (HttpContext context)
		{
			await _next(context);

			if(context.Response.StatusCode == 404) 
			{
				_logger.LogInformation($"handling 404 error");

				//context.Response.StatusCode = 404;


                string filePath = Path.Combine(Directory.GetCurrentDirectory(), "wwwroot/error404.html");

                using (var stream = new FileStream(filePath, FileMode.Open))
                using (var reader = new StreamReader(stream))
                {
                    string htmlContent = await reader.ReadToEndAsync();
                    await context.Response.WriteAsync(htmlContent);
                }


                //context.Response.ContentType = "text/html";
                //await context.Response.WriteAsync("404 ERROR CUSTOM");
                //await context.Response.WriteAsync("<!DOCTYPE html>\r\n<html lang=\"en\">\r\n\r\n<head>\r\n    <meta charset=\"utf-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\r\n    <meta name=\"description\" content=\"Magellano - NFT Marketplace Website Template by Ansonika\">\r\n    <meta name=\"author\" content=\"Ansonika\">\r\n    <title>Magellano - NFT Marketplace Website Template</title>\r\n\r\n    <!-- FAVICONS-->\r\n    <link rel=\"shortcut icon\" href=\"img/favicon.ico\" type=\"image/x-icon\">\r\n    <link rel=\"apple-touch-icon\" type=\"image/x-icon\" href=\"img/apple-touch-icon-57x57-precomposed.png\">\r\n    <link rel=\"apple-touch-icon\" type=\"image/x-icon\" sizes=\"72x72\" href=\"img/apple-touch-icon-72x72-precomposed.png\">\r\n    <link rel=\"apple-touch-icon\" type=\"image/x-icon\" sizes=\"114x114\" href=\"img/apple-touch-icon-114x114-precomposed.png\">\r\n    <link rel=\"apple-touch-icon\" type=\"image/x-icon\" sizes=\"144x144\" href=\"img/apple-touch-icon-144x144-precomposed.png\">\r\n\r\n    <!-- GOOGLE FONT -->\r\n    <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\">\r\n\t<link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin>\r\n\t<link href=\"https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap\" rel=\"stylesheet\">\r\n\r\n    <!-- BASE CSS -->\r\n\t<link href=\"css/bootstrap.min.css\" rel=\"stylesheet\">\r\n\t<link href=\"css/style.css\" rel=\"stylesheet\">\r\n\r\n    <!-- SPECIFIC CSS -->\r\n    <link href=\"css/error.css\" rel=\"stylesheet\">\r\n\r\n    <!-- YOUR CUSTOM CSS -->\r\n    <link href=\"css/custom.css\" rel=\"stylesheet\">\r\n</head>\r\n\r\n<body>\r\n\r\n\t<div id=\"preloader\"><div data-loader=\"circle-side\"></div></div><!-- /Page Preload -->\r\n\t\t\t\t\r\n\t<header class=\"header clearfix element_to_stick\">\r\n\t    <div class=\"layer\"></div><!-- Opacity Mask Menu Mobile -->\r\n\t    <div class=\"container\">\r\n\t        <div class=\"logo\">\r\n\t            <a href=\"index.html\">\r\n\t                <img src=\"img/logo.svg\" alt=\"\" width=\"140\" height=\"35\">\r\n\t            </a>\r\n\t        </div>\r\n\t        <ul class=\"top_menu\">\r\n\t            <li><a href=\"login.html\" class=\"btn_access\">Log In</a></li>\r\n\t            <li><a href=\"connect-wallet.html\" class=\"btn_access\">Connect Wallet</a></li>\r\n\t        </ul>\r\n\t        <!-- /top_menu -->\r\n\t        <a href=\"#0\" class=\"open_close\">\r\n\t            <i class=\"bi bi-list\"></i><span>Menu</span>\r\n\t        </a>\r\n\t        <nav class=\"main-menu\">\r\n\t            <div id=\"header_menu\">\r\n\t                <a href=\"#0\" class=\"open_close\">\r\n\t                    <i class=\"bi bi-x\"></i>\r\n\t                </a>\r\n\t                <a href=\"index.html\"><img src=\"img/logo-placeholder.png\" data-src=\"img/logo.svg\" width=\"120\" height=\"30\" alt=\"\" class=\"lazy\"></a>\r\n\t            </div>\r\n\t            <ul>\r\n\t                <li class=\"submenu\">\r\n\t                    <a href=\"#0\" class=\"show-submenu\">Home</a>\r\n\t                    <ul>\r\n\t                        <li><a href=\"index.html\">Default</a></li>\r\n\t                        <li><a href=\"index-2.html\">Experimental Particles</a></li>\r\n\t                        <li><a href=\"index-10.html\">Particles</a></li>\r\n\t                        <li><a href=\"index-3.html\">Video Background</a></li>\r\n\t                        <li><a href=\"index-4.html\">Vertical Slider</a></li>\r\n\t                        <li><a href=\"index-5.html\">Slider</a></li>\r\n\t                        <li><a href=\"index-6.html\">Hero Categories</a></li>\r\n\t                        <li><a href=\"index-11.html\">Hero Vesion 2</a></li>\r\n\t                        <li><a href=\"index-7.html\">GDPR Cookie Bar EU Law</a></li>\r\n\t                        <li><a href=\"index-8.html\">Modal Advertise</a></li>\r\n\t                        <li><a href=\"index-9.html\">Modal Newsletter</a></li>\r\n\t                    </ul>\r\n\t                </li>\r\n\t                <li class=\"submenu\">\r\n\t                    <a href=\"#0\" class=\"show-submenu\">Explore</a>\r\n\t                    <ul>\r\n\t                        <li><a href=\"grid-listing-1.html\">Grid Listing Default</a></li>\r\n\t                        <li><a href=\"grid-listing-2.html\">Grid Listing Isotope Sort</a></li>\r\n\t                        <li><a href=\"grid-listing-3.html\">Grid Listing Filters Left</a></li>\r\n\t                        <li><a href=\"detail-page.html\">Detail page 1</a></li>\r\n\t                        <li><a href=\"detail-page-2.html\">Detail page 2</a></li>\r\n\t                        <li><a href=\"author.html\">Author page</a></li>\r\n\t                    </ul>\r\n\t                </li>\r\n\t                <li class=\"submenu\">\r\n\t                    <a href=\"#0\" class=\"show-submenu\">Pages</a>\r\n\t                    <ul>\r\n\t                        <li><a href=\"404.html\">404 Error</a></li>\r\n\t                        <li><a href=\"help.html\">Help and Faq</a></li>\r\n\t                        <li class=\"third-level\"><a href=\"#0\">Pricing Tables</a>\r\n\t                            <ul>\r\n\t                                <li><a href=\"pricing-tables-1.html\">Version 1</a></li>\r\n\t                                <li><a href=\"pricing-tables-2.html\">Version 2</a></li>\r\n\t                                <li><a href=\"pricing-tables-3.html\">Version 3</a></li>\r\n\t                            </ul>\r\n\t                        </li>\r\n\t                        <li><a href=\"become-author.html\">Become an Author</a></li>\r\n\t                        <li><a href=\"author-edit-profile.html\">Edit profile</a></li>\r\n\t                        <li><a href=\"upload-artwork.html\">Upload Artwork</a></li>\r\n\t                        <li><a href=\"account-settings.html\">Account Settings</a></li>\r\n\t                        <li><a href=\"blog.html\">Blog</a></li>\r\n\t                        <li><a href=\"blog-no-sidebar.html\">Blog no sidebar</a></li>\r\n\t                        <li><a href=\"contacts.html\">Contacts</a></li>\r\n\t                        <li><a href=\"login.html\">Login</a></li>\r\n\t                        <li><a href=\"register.html\">Register</a></li>\r\n\t                    </ul>\r\n\t                </li>\r\n\t                <li><a href=\"#0\">Buy this template</a></li>\r\n\t            </ul>\r\n\t        </nav>\r\n\t    </div>\r\n\t</header>\r\n\t<!-- /header -->\r\n\t\r\n\t<main>\r\n\t    <div id=\"error_page\" class=\"hero_single inner_pages background-image\" data-background=\"url(img/hero_general.jpg)\">\r\n\t        <div class=\"opacity-mask\" data-opacity-mask=\"rgba(0, 0, 0, 0.5)\">\r\n\t            <div class=\"container\">\r\n\t                <div class=\"row justify-content-center text-center\">\r\n\t                    <div class=\"col-xl-7 col-lg-9\">\r\n\t                        <figure class=\"slide-animated one\"><img src=\"img/404.svg\" alt=\"\" class=\"img-fluid\"></figure>\r\n\t                        <p class=\"slide-animated two\">We're sorry, but the page you were looking for doesn't exist.</p>\r\n\t                        <form class=\"slide-animated three\">\r\n\t                            <div class=\"search_bar\">\r\n\t                                <input type=\"text\" class=\"form-control\" placeholder=\"What are you looking for?\">\r\n\t                                <input type=\"submit\" value=\"Search\">\r\n\t                            </div>\r\n\t                        </form>\r\n\t                    </div>\r\n\t                </div>\r\n\t                <!-- /row -->\r\n\t            </div>\r\n\t            <!-- /container -->\r\n\t        </div>\r\n\t        <div class=\"wave black_2 hero\"></div>\r\n\t    </div>\r\n\t    <!-- /error -->\r\n\t</main>\r\n\t<!-- /main -->\r\n\r\n\t<footer class=\"no_border\">\r\n\t\t<div class=\"container\">\r\n\t\t\t<div class=\"row\">\r\n\t\t\t\t<div class=\"col-lg-3 col-md-6 col-sm-6\">\r\n\t\t\t\t\t<h3>Marketplace</h3>\r\n\t\t\t\t\t<div class=\"links\">\r\n\t\t\t\t\t\t<ul>\r\n\t\t\t\t\t\t\t<li><a href=\"index.html\">Home</a></li>\r\n\t\t\t\t\t\t\t<li><a href=\"grid-listing-1.html\">Explore</a></li>\r\n\t\t\t\t\t\t\t<li><a href=\"login.html\">Login</a></li>\r\n\t\t\t\t\t\t\t<li><a href=\"register.html\">Register</a></li>\r\n\t\t\t\t\t\t\t<li><a href=\"contacts.html\">Contacts</a></li>\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</div>\r\n\t\t\t\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"col-lg-3 col-md-6 col-sm-6\">\r\n\t\t\t\t\t<h3>Useful Links</h3>\r\n\t\t\t\t\t<div class=\"links\">\r\n\t\t\t\t\t\t<ul>\r\n\t\t\t\t\t\t\t<li><a href=\"help.html\">Help Center</a></li>\r\n\t\t\t\t\t\t\t<li><a href=\"connect-wallet.html\">Connect Wallet</a></li>\r\n\t\t\t\t\t\t\t<li><a href=\"help.html\">Faq</a></li>\r\n\t\t\t\t\t\t\t<li><a href=\"pricing-tables-2.html\">Pricing</a></li>\r\n\t\t\t\t\t\t\t<li><a href=\"contacts.html\">Become an Author</a></li>\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"col-lg-3 col-md-6 col-sm-6\">\r\n\t\t\t\t\t<h3>Resources</h3>\r\n\t\t\t\t\t<div class=\"links\">\r\n\t\t\t\t\t\t<ul>\r\n\t\t\t\t\t\t\t<li><a href=\"#0\">Blog</a></li>\r\n\t\t\t\t\t\t\t<li><a href=\"#0\">Community</a></li>\r\n\t\t\t\t\t\t\t<li><a href=\"#0\">Best Price</a></li>\r\n\t\t\t\t\t\t\t<li><a href=\"#0\">Latest Submissions</a></li>\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"col-lg-3 col-md-6 col-sm-6\">\r\n\t\t\t\t    <h3>Keep in touch</h3>\r\n\t\t\t\t    <div id=\"newsletter\">\r\n\t\t\t\t        <div id=\"message-newsletter\"></div>\r\n\t\t\t\t        <form method=\"post\" name=\"newsletter_form\" id=\"newsletter_form\">\r\n\t\t\t\t            <div class=\"form-group\">\r\n\t\t\t\t                <input type=\"email\" name=\"email_newsletter\" id=\"email_newsletter\" class=\"form-control\" placeholder=\"Your email\">\r\n\t\t\t\t                <button type=\"submit\" id=\"submit-newsletter\"><i class=\"bi bi-chevron-right\"></i></button>\r\n\t\t\t\t            </div>\r\n\t\t\t\t        </form>\r\n\t\t\t\t    </div>\r\n\t\t\t\t    <div class=\"follow_us\">\r\n\t\t\t\t        <ul>\r\n\t\t\t\t            <li>\r\n\t\t\t\t                <a href=\"#0\"><img src=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==\" data-src=\"img/twitter_icon.svg\" alt=\"\" class=\"lazy\"></a>\r\n\t\t\t\t            </li>\r\n\t\t\t\t            <li>\r\n\t\t\t\t                <a href=\"#0\"><img src=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==\" data-src=\"img/facebook_icon.svg\" alt=\"\" class=\"lazy\"></a>\r\n\t\t\t\t            </li>\r\n\t\t\t\t            <li><a href=\"#0\"><img src=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==\" data-src=\"img/instagram_icon.svg\" alt=\"\" class=\"lazy\"></a>\r\n\t\t\t\t            </li>\r\n\t\t\t\t            <li>\r\n\t\t\t\t                <a href=\"#0\"><img src=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==\" data-src=\"img/youtube_icon.svg\" alt=\"\" class=\"lazy\"></a>\r\n\t\t\t\t            </li>\r\n\t\t\t\t        </ul>\r\n\t\t\t\t    </div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<!-- /row-->\r\n\t\t\t<hr>\r\n\t\t\t<div class=\"row add_bottom_25\">\r\n\t\t\t\t<div class=\"col-md-6\">\r\n\t\t\t\t\t<ul class=\"footer-selector clearfix\">\r\n\t\t\t\t\t\t<li>\r\n\t\t\t\t\t\t\t<div class=\"styled-select lang-selector\">\r\n\t\t\t\t\t\t\t\t<select>\r\n\t\t\t\t\t\t\t\t\t<option value=\"English\" selected>English</option>\r\n\t\t\t\t\t\t\t\t\t<option value=\"French\">French</option>\r\n\t\t\t\t\t\t\t\t\t<option value=\"Spanish\">Spanish</option>\r\n\t\t\t\t\t\t\t\t\t<option value=\"Russian\">Russian</option>\r\n\t\t\t\t\t\t\t\t</select>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</li>\r\n\t\t\t\t\t</ul>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"col-md-6\">\r\n\t\t\t\t\t<ul class=\"additional_links\">\r\n\t\t\t\t\t\t<li><a href=\"#0\">Terms and conditions</a></li>\r\n\t\t\t\t\t\t<li>© 2022 Magellano</li>\r\n\t\t\t\t\t</ul>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</footer>\r\n\t<!--/footer-->\r\n\r\n\t<div id=\"toTop\"></div><!-- Back to top button -->\r\n\t\r\n\t<!-- COMMON SCRIPTS -->\r\n    <script src=\"js/common_scripts.min.js\"></script>\r\n    <script src=\"js/bootstrap.bundle.min.js\"></script>\r\n    <script src=\"js/common_func.js\"></script>\r\n\r\n</body>\r\n</html>");

            }
        }
	}
}
